###############################################################################
#
#     PACKAGE:  Raspberry Pi Data Acquisition and Control System (PiDACS)
#        FILE:  install
#       TITLE:  Install the PiDACS package
#    FUNCTION:  Install PiDACS files in the current working drectory.
#       USAGE:  source src/pidacs/install or p2pkg -i pidacs (see examples
#               below).
#      AUTHOR:  papamac
#        DATE:  September 20, 2019
#
# DESCRIPTION:
#
# The install script installs scripts package files that have already been
# downloaded to the src sub-directory of the current working directory.
# Specifically, it copies src/scripts/bash_aliases to .bash_aliases in the HOME
# directory; it marks the src/scripts/p2pkg file as executable; and it creates
# a symbolic link to p2pkg in the bin sub-directory of the current working
# directory.  Additionally, install creates HOME/bin if none exists.
#
# install is designed to be used with p2pkg.  Normally, the scripts package is
# downloaded to the current working directory using ftp (-f) or git (-g) and
# then installed (-i).  If scripts is to be installed in a root-owned
# directory, p2pkg -i must be executed using sudo.  Usage examples are as
# follows:
#
# p2pkg -fi scripts                     # Download the scripts package from the
#                                         ftp server and install it in the
#                                         HOME and current working directories.
# cd /usr/local                         # Download the scripts package from
# sudo -E p2pkg -gi scripts               github and install it in the HOME
#                                         and /usr/local directories.
#
# DEPENDENCIES/LIMITATIONS:
#
# When running install via p2pkg in a sudo environment, sudo -E must be used to
# preserve the user's HOME directory.  install checks for this and exits if
# $HOME is /root.  papamac's runtime environment (see bash_aliases) prevents
# this from hapening by aliasing sudo to sudo -E.
#
# DESCRIPTION:
#
# The install script installs PiDACS package files that have already been
# downloaded to the src sub-directory of the current working directory.
# Specifically, it marks the PiDACS executable files (iomgr.py, pidacs-c.py,
# pidacs-s.py, and pidacsd) as executable and it creates symbolic links to
# these executables in the bin sub-directory of the current working directory.
# install does not install or start the PiDACS daemon.  Use the option script
# to do this after install is complete.
#
# install is designed to be used with papamac's personal package utility
# (p2pkg).  Normally, the PiDACS package is downloaded to the current working
# directory using ftp (p2pkg -f) or git (p2pkg -g) and then installed
# (p2pkg -i).  If PiDACS is to be installed in a root-owned directory, p2pkg -i
# must be executed using sudo.  Usage examples are as follows:
#
# p2pkg -fi PiDACS                      # Download the PiDACS package from the
#                                         ftp server and install it in the
#                                         current working directory.
# cd /usr/local                         # Download the PiDACS package from
# sudo -E p2pkg -gi PiDACS                github and install it in /usr/local.
#
# DEPENDENCIES/LIMITATIONS:
#
# When running install via p2pkg in a sudo environment, sudo -E must be used to
# preserve the user's HOME directory.  install checks for this and exits if
# $HOME is /root.  papamac's runtime environment (see bash_aliases) prevents
# this from hapening by aliasing sudo to sudo -E.
#
###############################################################################

# If the port_names argument is specified, pidacsd is also installed, linked
# for automatic startup on reboot, and started in the current boot session.
# port_names must be a string of three-character I/O port names separated by
# spaces, e.g., 'ab0 ab1 ga0 gb0'.  This string is edited into the pidacsd
# script as the argument to the pidacs executable.

# Install files in the <src>/pidacs directory by setting executable bits and
# creating executable links.

infomsg "install: creating PiDACS executable links in $y$t$bin$n"
chmod +x $pkg/iomgr.py  $pkg/pidacs-c.py $pkg/pidacs-s.py $pkg/pidacsd
ln -fs   $pkg/iomgr.py    $bin/iomgr
ln -fs   $pkg/pidacs-c.py $bin/pidacs-c
ln -fs   $pkg/pidacs-s.py $bin/pidacs-s
ln -fs   $pkg/pidacsd     $bin/pidacsd
